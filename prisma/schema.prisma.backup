// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// Modelos do banco de dados

model User {
  id          String   @id @default(cuid())
  email       String   @unique
  name        String
  password    String
  role        Role     @default(OWNER)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relacionamentos
  salon       Salon?
  appointments Appointment[]
  
  @@map("users")
}

model Salon {
  id            String   @id @default(cuid())
  name          String
  ownerName     String
  email         String
  phone         String
  address       String
  city          String
  state         String
  zipCode       String
  description   String?
  logo          String?
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relacionamentos
  ownerId       String   @unique
  owner         User     @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  clients       Client[]
  services      Service[]
  appointments  Appointment[]
  transactions  Transaction[]
  workingHours  WorkingHours[]
  integrations  Integration[]
  
  @@map("salons")
}

model Client {
  id          String   @id @default(cuid())
  name        String
  email       String?
  phone       String
  birthDate   DateTime?
  address     String?
  notes       String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relacionamentos
  salonId     String
  salon       Salon    @relation(fields: [salonId], references: [id], onDelete: Cascade)
  appointments Appointment[]
  
  @@map("clients")
}

model Service {
  id          String   @id @default(cuid())
  name        String
  description String?
  price       Float        // em SQLite usamos Float ao invés de Decimal
  duration    Int      // em minutos
  category    String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relacionamentos
  salonId     String
  salon       Salon    @relation(fields: [salonId], references: [id], onDelete: Cascade)
  appointments Appointment[]
  
  @@map("services")
}

model Appointment {
  id          String            @id @default(cuid())
  date        DateTime
  startTime   DateTime
  endTime     DateTime
  status      AppointmentStatus @default(SCHEDULED)
  notes       String?
  totalPrice  Float             // em SQLite usamos Float
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  
  // Relacionamentos
  clientId    String
  client      Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)
  serviceId   String
  service     Service  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  salonId     String
  salon       Salon    @relation(fields: [salonId], references: [id], onDelete: Cascade)
  
  @@map("appointments")
}

model Transaction {
  id          String          @id @default(cuid())
  type        TransactionType
  amount      Float           // em SQLite usamos Float
  description String
  category    String
  paymentMethod PaymentMethod
  date        DateTime        @default(now())
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  
  // Relacionamentos
  salonId     String
  salon       Salon @relation(fields: [salonId], references: [id], onDelete: Cascade)
  
  @@map("transactions")
}

model WorkingHours {
  id        String    @id @default(cuid())
  dayOfWeek Int       // 0-6 (Domingo-Sábado)
  startTime String    // "09:00"
  endTime   String    // "18:00"
  isClosed  Boolean   @default(false)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  
  // Relacionamentos
  salonId   String
  salon     Salon @relation(fields: [salonId], references: [id], onDelete: Cascade)
  
  @@unique([salonId, dayOfWeek])
  @@map("working_hours")
}

model Integration {
  id            String          @id @default(cuid())
  type          IntegrationType
  isEnabled     Boolean         @default(false)
  config        Json            // Configurações específicas de cada integração
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  
  // Relacionamentos
  salonId       String
  salon         Salon @relation(fields: [salonId], references: [id], onDelete: Cascade)
  
  @@unique([salonId, type])
  @@map("integrations")
}

// Enums
enum Role {
  OWNER
  EMPLOYEE
  ADMIN
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  NO_SHOW
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum PaymentMethod {
  CASH
  CREDIT_CARD
  DEBIT_CARD
  PIX
  BANK_TRANSFER
}

enum IntegrationType {
  WHATSAPP
  GOOGLE_CALENDAR
  PAYMENT_GATEWAY
}

// Modelos para sistema de licenças
model License {
  id              String          @id @default(cuid())
  licenseKey      String          @unique
  planType        LicensePlanType
  status          LicenseStatus   @default(PENDING)
  clientId        String
  clientName      String
  clientEmail     String
  createdAt       DateTime        @default(now())
  expiresAt       DateTime
  maxUsers        Int
  paymentStatus   PaymentStatus   @default(PENDING)
  renewalDate     DateTime?
  updatedAt       DateTime        @updatedAt
  
  // Relacionamento com recursos
  features        LicenseFeature[]
  
  @@map("licenses")
}

model LicenseFeature {
  id          String   @id @default(cuid())
  name        String
  enabled     Boolean  @default(true)
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relacionamentos
  licenseId   String
  license     License  @relation(fields: [licenseId], references: [id], onDelete: Cascade)
  
  @@map("license_features")
}

// Modelo estendido de Cliente para sistema de licenças
model LicenseClient {
  id          String   @id @default(cuid())
  name        String
  email       String   @unique
  phone       String?
  company     String?
  cnpj        String?
  licenseKey  String?
  totalRevenue Float?   @default(0) // em SQLite usamos Float
  status      ClientStatus @default(ACTIVE)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Endereço
  street      String?
  number      String?
  city        String?
  state       String?
  zipCode     String?
  country     String?
  
  @@map("license_clients")
}

// Enums para sistema de licenças
enum LicensePlanType {
  BASIC
  PREMIUM
  ENTERPRISE
}

enum LicenseStatus {
  ACTIVE
  EXPIRED
  SUSPENDED
  PENDING
}

enum PaymentStatus {
  PAID
  PENDING
  FAILED
  CANCELLED
}

enum ClientStatus {
  ACTIVE
  INACTIVE
  VIP
}
